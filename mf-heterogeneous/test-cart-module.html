<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Cart Module Federation</title>
</head>
<body>
    <h1>Testing Cart Module Federation</h1>
    <div id="result"></div>
    
    <script>
        async function testCartModule() {
            const resultDiv = document.getElementById('result');
            
            try {
                // Test 1: Check if remoteEntry.js is accessible
                resultDiv.innerHTML += '<p>üîÑ Testing remoteEntry.js accessibility...</p>';
                const response = await fetch('http://localhost:4003/remoteEntry.js');
                if (response.ok) {
                    resultDiv.innerHTML += '<p>‚úÖ remoteEntry.js is accessible (Status: ' + response.status + ')</p>';
                } else {
                    resultDiv.innerHTML += '<p>‚ùå remoteEntry.js not accessible (Status: ' + response.status + ')</p>';
                    return;
                }
                
                // Test 2: Try to load the module
                resultDiv.innerHTML += '<p>üîÑ Attempting to load cart module...</p>';
                
                // This mimics what Module Federation does
                const script = document.createElement('script');
                script.src = 'http://localhost:4003/remoteEntry.js';
                script.onload = async () => {
                    try {
                        resultDiv.innerHTML += '<p>‚úÖ Script loaded successfully</p>';
                        
                        // Check what's available on the global scope
                        if (window.cart) {
                            resultDiv.innerHTML += '<p>‚úÖ Cart module found on global scope</p>';
                            
                            // Try to get the Cart component
                            const cartModule = await window.cart.get('./Cart');
                            resultDiv.innerHTML += '<p>‚úÖ Cart module get() succeeded</p>';
                            resultDiv.innerHTML += '<p>Module keys: ' + Object.keys(cartModule).join(', ') + '</p>';
                            
                            const cartComponent = cartModule();
                            resultDiv.innerHTML += '<p>‚úÖ Cart component factory called</p>';
                            resultDiv.innerHTML += '<p>Component keys: ' + Object.keys(cartComponent).join(', ') + '</p>';
                            
                        } else {
                            resultDiv.innerHTML += '<p>‚ùå Cart module not found on global scope</p>';
                            resultDiv.innerHTML += '<p>Available globals: ' + Object.keys(window).filter(k => k.includes('cart') || k.includes('mf')).join(', ') + '</p>';
                        }
                    } catch (error) {
                        resultDiv.innerHTML += '<p>‚ùå Error accessing module: ' + error.message + '</p>';
                    }
                };
                script.onerror = () => {
                    resultDiv.innerHTML += '<p>‚ùå Failed to load script</p>';
                };
                document.head.appendChild(script);
                
            } catch (error) {
                resultDiv.innerHTML += '<p>‚ùå Error: ' + error.message + '</p>';
            }
        }
        
        // Run the test when page loads
        window.addEventListener('load', testCartModule);
    </script>
</body>
</html>
